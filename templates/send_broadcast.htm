{% extends "layout.html" %}

{% block title %}Enviar Mensagem em Massa - Bot Telegram{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Enviar Mensagem em Massa (Broadcast)</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-4">
                {% for category, message in messages %}
                    <div class="p-3 rounded-md {% if category == 'success' %}bg-green-100 text-green-800{% elif category == 'danger' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <form method="POST" action="{{ url_for('send_broadcast') }}" class="bg-white shadow-md rounded-lg p-6 mb-6">
        <div class="mb-4">
            <label for="message_text" class="block text-gray-700 text-sm font-bold mb-2">Texto da Mensagem:</label>
            <textarea id="message_text" name="message_text" rows="5" required class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline resize-y" placeholder="Sua mensagem para todos os usuários..."></textarea>
            <p class="text-xs text-gray-500 mt-1">Esta mensagem será enviada para todos os usuários que iniciaram uma conversa com o seu bot.</p>
        </div>
        <div class="mb-4">
            <label for="image_url" class="block text-gray-700 text-sm font-bold mb-2">URL da Imagem ou Vídeo (Opcional):</label>
            <input type="url" id="image_url" name="image_url" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline" placeholder="[https://exemplo.com/sua-imagem-ou-video.jpg](https://exemplo.com/sua-imagem-ou-video.jpg)">
            <p class="text-xs text-gray-500 mt-1">Insira uma URL direta para a imagem ou vídeo. Será enviada como prévia (o Telegram pode converter vídeos curtos para GIFs). Imagens sensuais ou +18 devem seguir as diretrizes do Telegram para mídia explícita, que geralmente não é exibida diretamente em previews em alguns clientes.</p>
        </div>
        
        <div class="flex items-center justify-between">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
                Enviar Broadcast
            </button>
            <a href="{{ url_for('index') }}" class="inline-block align-baseline font-bold text-sm text-gray-600 hover:text-gray-800">
                Cancelar
            </a>
        </div>
    </form>
</div>
{% endblock %}

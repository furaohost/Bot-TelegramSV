{% extends 'layout.html' %}

{% block title %}Comunidades{% endblock %}
{% block page_title %}Gerenciar Comunidades{% endblock %} {# Title for the main header #}

{% block content %}
<div class="dashboard-content-wrapper"> {# Uses the dashboard wrapper for centering and width #}
    {# O cabeçalho já está bem estilizado, mantemos as classes do layout e adicionamos flex-between para clareza #}
    <div class="header flex-between" style="margin-bottom: 2rem;">
        <h2 class="page-title" style="margin-bottom: 0;">Gerenciar Comunidades</h2>
        <a href="{{ url_for('comunidades.nova') }}" class="btn btn-primary">
            <span class="material-icons">add</span>
            Nova Comunidade
        </a>
    </div>

    {# As mensagens flash agora são gerenciadas pelo layout.html, conforme discutido. #}

    <div class="card"> {# Usamos a classe 'card' para o contêiner da tabela #}
        {% if comunidades %}
        <div class="table-container"> {# Usa 'table-container' para rolagem e bordas #}
            <table class="data-table"> {# Usa 'data-table' #}
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Descrição</th>
                        <th>Chat ID</th>
                        <th>Status</th>
                        <th>Criado Em</th>
                        <th class="actions-cell">Ações</th> {# Aplicando a classe actions-cell para centralizar #}
                    </tr>
                </thead>
                <tbody>
                    {% for comunidade in comunidades %}
                    <tr>
                        <td>{{ comunidade.id }}</td>
                        <td class="break-word">{{ comunidade.nome }}</td> {# Aplicando a classe break-word para quebrar linha #}
                        <td class="break-word">{{ comunidade.descricao | default('N/A', true) }}</td> {# Aplicando a classe break-word para quebrar linha #}
                        <td class="break-word">{{ comunidade.chat_id | default('N/A', true) }}</td> {# Aplicando a classe break-word para quebrar linha #}
                        <td>
                            <span class="status
                                {% if comunidade.status == 'ativa' %}status-success
                                {% elif comunidade.status == 'inativa' %}status-danger
                                {% else %}status-info{% endif %}">
                                {{ comunidade.status | capitalize }}
                            </span>
                        </td>
                        <td>{{ comunidade.created_at | datetimeformat }}</td>
                        <td class="actions-cell"> {# Aplicando a classe actions-cell e removendo style inline #}
                            <a href="{{ url_for('comunidades.editar', cid=comunidade.id) }}" class="btn-action edit">
                                Editar
                            </a>
                            <form action="{{ url_for('comunidades.deletar', cid=comunidade.id) }}" method="POST" class="inline-form" onsubmit="return confirm('Tem certeza que deseja desativar esta comunidade?');">
                                <button type="submit" class="btn-action delete">
                                    Desativar
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-light text-center" style="padding: 2rem;">Não há comunidades cadastradas ainda. <a href="{{ url_for('comunidades.nova') }}" class="text-primary hover-text-primary-dark">Crie uma nova</a>!</p>
        {% endif %}
    </div>
</div>
{% endblock %}
{% extends 'layout.html' %} {# CRITICAL CORRECTION: Now extends layout.html for the sidebar dashboard look #}

{% block title %}Comunidades{% endblock %}
{% block page_title %}Gerenciar Comunidades{% endblock %} {# Title for the main header #}

{% block content %}
<div class="dashboard-content-wrapper"> {# Uses the dashboard wrapper for centering and width #}
    <div class="header" style="justify-content: space-between; align-items: center; margin-bottom: 2rem;"> {# Reusing header style for title and button #}
        <h2 class="page-title" style="margin-bottom: 0;">Gerenciar Comunidades</h2> {# Using page-title style #}
        <a href="{{ url_for('comunidades.nova') }}" class="btn btn-primary">
            <span class="material-icons">add</span> {# Using Material Icons for the plus symbol #}
            Nova Comunidade
        </a>
    </div>

    {# Flash messages are already handled by layout.html, so this block is redundant here #}
    {# Removed:
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-4">
                {% for category, message in messages %}
                    <div class="p-3 rounded-md {% if category == 'success' %}bg-green-100 text-green-800{% elif category == 'danger' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    #}

    <div class="card"> {# Using the 'card' class for the table container #}
        {% if comunidades %}
        <div class="table-container"> {# Uses the 'table-container' for scroll and borders #}
            <table class="data-table"> {# Uses the 'data-table' class #}
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Descrição</th>
                        <th>Chat ID</th>
                        <th>Status</th>
                        <th>Criado Em</th>
                        <th style="text-align: center;">Ações</th> {# Center align Actions header #}
                    </tr>
                </thead>
                <tbody>
                    {% for comunidade in comunidades %}
                    <tr>
                        <td>{{ comunidade.id }}</td>
                        <td style="white-space: normal;">{{ comunidade.nome }}</td> {# Allow text wrapping #}
                        <td style="white-space: normal;">{{ comunidade.descricao | default('N/A', true) }}</td> {# Allow text wrapping #}
                        <td>{{ comunidade.chat_id | default('N/A', true) }}</td>
                        <td>
                            <span class="status
                                {% if comunidade.status == 'ativa' %}status-success
                                {% elif comunidade.status == 'inativa' %}status-danger {# Assuming 'inativa' is a status #}
                                {% else %}status-info{% endif %}"> {# Use info for other unknown statuses #}
                                {{ comunidade.status | capitalize }}
                            </span>
                        </td>
                        <td>{{ comunidade.created_at | datetimeformat }}</td>
                        <td style="text-align: center; white-space: nowrap;"> {# Center align action buttons and prevent wrapping #}
                            <a href="{{ url_for('comunidades.editar', cid=comunidade.id) }}" class="btn-action edit">
                                Editar
                            </a>
                            <form action="{{ url_for('comunidades.deletar', cid=comunidade.id) }}" method="POST" class="inline-form" onsubmit="return confirm('Tem certeza que deseja desativar esta comunidade?');">
                                <button type="submit" class="btn-action delete">
                                    Desativar
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-light text-center" style="padding: 2rem;">Não há comunidades cadastradas ainda. <a href="{{ url_for('comunidades.nova') }}" class="text-primary hover-text-primary-dark">Crie uma nova</a>!</p> {# Uses text-light, text-primary, hover effects #}
        {% endif %}
    </div>
</div>
{% endblock %}
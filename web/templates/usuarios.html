{% extends "layout.html" %}

{% block title %}Usuários{% endblock %}
{% block page_title %}Gerenciar Usuários{% endblock %} {# Title for the main header #}

{% block content %}
<div class="dashboard-content-wrapper"> {# Uses the dashboard wrapper for centering and width #}
    <h1 class="page-title" style="margin-bottom: 2rem;">Gerenciar Usuários do Bot</h1> {# Using page-title style #}

    {# Flash messages are already handled by layout.html, so this block is redundant here. #}
    {# Removed:
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-4">
                {% for category, message in messages %}
                    <div class="p-3 mb-2 rounded-md {{ 'bg-green-100 text-green-800' if category == 'success' else ('bg-red-100 text-red-800' if category == 'danger' else 'bg-blue-100 text-blue-800') }}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    #}

    <div class="card"> {# Uses the 'card' class for the table container #}
        {% if usuarios %}
        <div class="table-container"> {# Uses the 'table-container' for scroll and borders #}
            <table class="data-table"> {# Uses the 'data-table' class #}
                <thead>
                    <tr>
                        <th scope="col" style="padding-left: 1.5rem;">ID</th> {# px-6 #}
                        <th scope="col">Username</th>
                        <th scope="col">Nome Completo</th>
                        <th scope="col">Data de Registro</th>
                        <th scope="col">Status</th>
                        <th scope="col" style="text-align: right; padding-right: 1.5rem;">Ações</th> {# sm:pr-6 #}
                    </tr>
                </thead>
                <tbody>
                    {% for usuario in usuarios %}
                    <tr>
                        <td style="padding-left: 1.5rem;">{{ usuario.id }}</td> {# sm:pl-6 #}
                        <td>@{{ usuario.username if usuario.username else 'N/A' }}</td>
                        <td>{{ usuario.first_name }} {{ usuario.last_name if usuario.last_name else '' }}</td>
                        <td>{{ usuario.data_registro.strftime('%d/%m/%Y %H:%M') if usuario.data_registro else 'N/A' }}</td>
                        <td>
                            <span class="status {% if usuario.is_active %}status-success{% else %}status-danger{% endif %}">
                                {{ 'Ativo' if usuario.is_active else 'Inativo' }}
                            </span>
                        </td>
                        <td style="text-align: right; white-space: nowrap; padding-right: 1.5rem;"> {# sm:pr-6 #}
                            {# Call to toggle_user_status route that activates/deactivates the user #}
                            <form action="{{ url_for('toggle_user_status', user_id=usuario.id) }}" method="POST" class="inline-form">
                                <button type="submit" class="btn-action {% if usuario.is_active %}delete{% else %}success{% endif %}"> {# Using delete for deactivate, success for activate #}
                                    {{ 'Desativar' if usuario.is_active else 'Ativar' }}
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-light text-center" style="padding: 2rem;">Nenhum usuário registrado no bot ainda.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
{% extends 'layout.html' %}

{% block title %}Comunidades{% endblock %} {# Título da aba do navegador #}
{% block page_title %}Gerenciar Comunidades{% endblock %} {# Título no header principal do dashboard #}

{% block content %}
<div class="dashboard-content-wrapper"> {# Usa o wrapper do dashboard para centralizar e limitar largura #}
    <div class="header" style="justify-content: space-between; align-items: center; margin-bottom: 2rem;"> {# Reutilizando header style para título e botão #}
        <h2 class="page-title" style="margin-bottom: 0;">Gerenciar Comunidades</h2> {# Usando page-title style #}
        <a href="{{ url_for('comunidades.nova') }}" class="btn btn-primary"> {# Assumindo que 'comunidades.nova' é a rota para adicionar uma nova #}
            <span class="material-icons">add</span> {# Usando Material Icons para o símbolo de mais #}
            Nova Comunidade
        </a>
    </div>

    {# Mensagens flash já são gerenciadas pelo layout.html, então este bloco é redundante aqui #}
    {# Removido:
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="mb-4">
                {% for category, message in messages %}
                    <div class="p-3 rounded-md {% if category == 'success' %}bg-green-100 text-green-800{% elif category == 'danger' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    #}

    <div class="card"> {# Usando a classe 'card' para o contêiner da tabela #}
        {% if comunidades %}
        <div class="table-container"> {# Usa o 'table-container' para scroll e bordas #}
            <table class="data-table"> {# Usa a classe 'data-table' #}
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Descrição</th>
                        <th>Chat ID</th>
                        <th>Status</th>
                        <th>Criado Em</th>
                        <th style="text-align: center;">Ações</th> {# Centraliza o cabeçalho Ações #}
                    </tr>
                </thead>
                <tbody>
                    {% for comunidade in comunidades %}
                    <tr>
                        <td>{{ comunidade.id }}</td>
                        <td style="white-space: normal;">{{ comunidade.nome }}</td> {# Permite quebra de linha #}
                        <td style="white-space: normal;">{{ comunidade.descricao | default('N/A', true) }}</td> {# Permite quebra de linha #}
                        <td>{{ comunidade.chat_id | default('N/A', true) }}</td>
                        <td>
                            <span class="status
                                {% if comunidade.status == 'ativa' %}status-success
                                {% elif comunidade.status == 'inativa' %}status-danger {# Assumindo 'inativa' é um status #}
                                {% else %}status-info{% endif %}"> {# Usa info para outros status desconhecidos #}
                                {{ comunidade.status | capitalize }}
                            </span>
                        </td>
                        <td>{{ comunidade.created_at | datetimeformat }}</td>
                        <td style="text-align: center; white-space: nowrap;"> {# Centraliza os botões de ação e impede quebra de linha #}
                            <a href="{{ url_for('comunidades.editar_comunidade', id=comunidade.id) }}" class="btn-action edit">
                                Editar
                            </a>
                            <form action="{{ url_for('comunidades.deletar', cid=comunidade.id) }}" method="POST" class="inline-form" onsubmit="return confirm('Tem certeza que deseja desativar esta comunidade?');">
                                <button type="submit" class="btn-action delete">
                                    Desativar
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-light text-center" style="padding: 2rem;">Não há comunidades cadastradas ainda. <a href="{{ url_for('comunidades.nova') }}" class="text-primary hover-text-primary-dark">Crie uma nova</a>!</p> {# Usa text-light, text-primary, efeitos de hover #}
        {% endif %}
    </div>
</div>
{% endblock %}